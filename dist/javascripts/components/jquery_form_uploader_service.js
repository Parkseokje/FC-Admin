"use strict";window.define(["common"],function(o){function t(o){e=this,e.extendOptions(o),e.init()}function n(o){return o=o.replace(/^http:\/\//i,"https://")}var e,a,i=i||window.$,d=d||window.axios,l=new window.XMLHttpRequest,p=i(".fileuploader-bar"),r=i(".fileuploader-percent"),c=i("#status"),u="0%";return t.prototype={options:{},extend:function(o,t){for(var n in t)t.hasOwnProperty(n)&&(o[n]=t[n]);return o},extendOptions:function(o){this.options=this.extend({},this.options),this.extend(this.options,o)},init:function(){i("#cancel-button").attr("disabled",!0),i("#upload-button").on("click",function(){if(!e.validate())return!1;i("#upload-button").attr("disabled",!0),i("#cancel-button").attr("disabled",!1),e.getUploadInfo()}),i("#cancel-button").on("click",function(o){l.abort(),e.cancelUpload()})},getUploadInfo:function(){d.get("/api/v1/fineuploader/token").then(function(o){var t=o.data;t&&(e.options.uploadUrl=n(t.uploadInfo.uploadUrl.replace("v4","cdnovp")),e.options.uploadCancelUrl=n(t.uploadInfo.uploadCancelUrl),e.options.token=t.uploadInfo.token,e.options.deploy_package_id=t.deploy_package_id,e.options.folder_id=t.folder_id,e.send())})},clearForm:function(){i("#upload-button").attr("disabled",!1),i("#cancel-button").attr("disabled",!0),i("#fileupload").val(""),u="0%",p.width(u),r.html(u)},cancelUpload:function(){d.post(e.options.uploadCancelUrl+"?token="+e.options.token,{token:e.options.token}).then(function(o){window.alert("업로드 취소"),e.clearForm()}).catch(function(o){console.log(o)})},validate:function(){return 0!==i("#fileupload").get(0).files.length||(window.alert("파일을 선택하세요."),!1)},send:function(){var t=new window.FormData,n=i("#fileupload").get(0).files[0];a=o.makeid()+".mp4",t.append("token",e.options.token),t.append("folder",e.options.folder_id),t.append("pkg",e.options.deploy_package_id),t.append("target_path",e.options.uploadFolder),t.append("videofile",n,a),i.ajax({url:e.options.uploadUrl+"?token="+e.options.token,data:t,type:"post",contentType:!1,processData:!1,cache:!1,beforeSend:function(){c.empty(),u="0%",p.width(u),r.html(u)},xhr:function(){return l.upload&&l.upload.addEventListener("progress",function(o){o.lengthComputable&&(u=Math.floor(o.loaded/o.total*100)+"%",p.width(u),r.html(u))},!1),l},success:function(o){var t=JSON.parse(o);"None"===t.uploadInfo.errorInfo.errorCode?(u="100%",p.width(u),r.html(u),window.alert("업로드 성공"),e.clearForm(),i("#aqua-video-code").val("onm_"+a),i("#fineUploader").modal("hide"),e.options.callback({success:!0,videoName:a,pkg:1006241,access_key:t.uploadInfo.uploadDetail.access_key,token:e.options.token})):window.alert(t.uploadInfo.errorInfo.errorMessage),i("#upload-button").attr("disabled",!1),i("#cancel-button").attr("disabled",!0)}})},send2:function(){}},t});
//# sourceMappingURL=../../maps/components/jquery_form_uploader_service.js.map
