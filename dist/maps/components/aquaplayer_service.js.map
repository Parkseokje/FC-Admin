{"version":3,"sources":["components/aquaplayer_service.js"],"names":["window","define","Util","ax","AquaPlayerService","options","self","extendOptions","encodedParam","player","$","prototype","a","b","extend","key","hasOwnProperty","this","init","getEncodedParam","initPlayer","resize","html5","getOSName","initPlayerHTML","initPlayerWindow","NPlayer","controlBox","visible","initNPlayerUI","bindEvent","setSecurePage","proxy_init","setPlayerStart","setNPlayer","mygentAuthCall","genkey","setMediaInfo","fileUrl","url","getMediaURL","open","URL","encodeURI","indicateInstall","indicateUpdate","state","OpenState","Opened","Closed","Stophtml5State","PlayState","Playing","Stopped","Paused","setVisible","name","desc","ec","setAxPlugin","testWatermark","setCDNAuthParam","addContextMenu","AquaAxPlugin","console","log","LoadSystemInfomation","onunload","setWatermarkText","setWatermarkInterval","setWatermarkLocation","testSubtitle1","err","reportError","setSubtitleFont","setSubtitleColor","setSubtitleText","testSubtitle2","setTimeout","height","watermark","setSubtitlePosition","testSubtitle","testSubtitle3"],"mappings":"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","file":"components/aquaplayer_service.js","sourcesContent":["\"use strict\";\nwindow.define([\"common\", \"axplugin\", \"nplayer\", \"nplayer_ui\", \"cdnproxy\", \"nplayer_conf\"], function(Util, ax) {\n  var self = null;\n  var encodedParam;\n  var player;\n  var $ = $ || window.$;\n\n  function AquaPlayerService(options) {\n    self = this;\n\n    self.extendOptions(options);\n    self.init();\n  }\n\n  AquaPlayerService.prototype = {\n    // 옵션 저장 변수\n    options: {},\n    extend: function(a, b) {\n      for (var key in b) {\n        if (b.hasOwnProperty(key)) {\n          a[key] = b[key];\n        }\n      }\n      return a;\n    },\n    // 옵션 확장\n    extendOptions: function(options) {\n      this.options = this.extend({}, this.options);\n      this.extend(this.options, options);\n    },\n    // 컴포넌트 초기화\n    init: function() {\n      self.getEncodedParam();\n      self.resize();\n    },\n    initPlayer: function() {\n      $(window).resize();\n\n      self.options.html5 = Util.getOSName() !== \"Windows\";\n\n      if (self.options.html5) {\n        self.initPlayerHTML();\n      } else if (\"ActiveXObject\" in window) {\n        self.initPlayerWindow();\n      }\n    },\n    // Player 초기화\n    initPlayerHTML: function() {\n      player = new window.NPlayer(\"video\", {\n        controlBox: \"nplayer_control.html\",\n        visible: false,\n        mode: \"html5\"\n      });\n\n      window.player = player;\n\n      window.initNPlayerUI(player);\n\n      player.bindEvent(\"Ready\", function() {\n        // self.reportMessage('ready');\n        window.setSecurePage(true);\n\n        window.proxy_init(\n          function() {\n            // 1. video start set\n            window.setPlayerStart(true);\n            // 2. nplayer instance set\n            window.setNPlayer(player);\n            // 4. media info set\n            window.mygentAuthCall(function(genkey) {\n              window.setMediaInfo(self.options.fileUrl, genkey);\n\n              var url = window.getMediaURL(true);\n              player.open({\n                URL: window.encodeURI(url)\n              });\n            }, encodedParam);\n          },\n          window.indicateInstall,\n          window.indicateUpdate\n        );\n      });\n\n      player.bindEvent(\"OpenStateChanged\", function(state) {\n        // self.reportMessage('OpenStateChanged');\n\n        switch (state) {\n        case window.NPlayer.OpenState.Opened:\n          player.setVisible(true);\n          window.starthtml5State();\n          break;\n        case window.NPlayer.OpenState.Closed:\n          window.Stophtml5State(window.NPlayer.OpenState.Closed);\n          break;\n        }\n      });\n\n      player.bindEvent(\"PlayStateChanged\", function(state) {\n        // self.reportMessage('PlayStateChanged');\n\n        switch (state) {\n        case window.NPlayer.PlayState.Playing:\n          player.setVisible(true);\n          break;\n\n        case window.NPlayer.PlayState.Stopped:\n          player.setVisible(false);\n          break;\n\n        case window.NPlayer.PlayState.Paused:\n          player.setVisible(true);\n          break;\n        }\n      });\n\n      player.bindEvent(\"GuardCallback\", function(name, desc) {\n        self.reportMessage(\"GuardCallback - \" + name + \" : \" + desc);\n      });\n\n      player.bindEvent(\"Error\", function(ec) {\n        self.reportMessage(\"Error - \" + ec);\n      });\n    },\n    initPlayerWindow: function() {\n      // self.options.fileUrl = 'http://eng-media-02.cdngc.net/cdnlab/cs1/tsbox/CSS_1500k.mp4';\n\n      player = new window.NPlayer(\"video\", {\n        controlBox: \"nplayer_control.html\",\n        visible: false\n      });\n      var setAxPlugin = false;\n\n      window.player = player;\n      self.testWatermark();\n\n      window.initNPlayerUI(player);\n\n      player.bindEvent(\"Ready\", function() {\n        // self.reportMessage('Ready');\n\n        player.setCDNAuthParam(encodedParam);\n        player.addContextMenu(\"SystemInfo\", \"sysinfo\");\n\n        // console.log(window.encodeURI(self.options.fileUrl));\n\n        player.open({\n          URL: window.encodeURI(self.options.fileUrl)\n        });\n      });\n\n      player.bindEvent(\"OpenStateChanged\", function(state) {\n        // self.reportMessage('OpenStateChanged');\n\n        switch (state) {\n        case window.NPlayer.OpenState.Opened:\n          player.setVisible(true);\n          break;\n        case window.NPlayer.OpenState.Closed:\n          break;\n        }\n      });\n\n      player.bindEvent(\"PlayStateChanged\", function(state) {\n        // self.reportMessage('PlayStateChanged');\n\n        switch (state) {\n        case window.NPlayer.PlayState.Playing:\n          player.setVisible(true);\n\n            // if (ax.isDup === true) {\n            //   player.stop();\n            //   window.alert(window.NPLAYER_DUP_MSG);\n            //   break;\n            // }\n\n          if (setAxPlugin === true) {\n            window.AquaAxPlugin.PlayState = window.NPlayer.PlayState.Playing;\n            window.AquaAxPlugin.OpenStateChange();\n          }\n          break;\n\n        case window.NPlayer.PlayState.Stopped:\n          player.setVisible(false);\n          break;\n\n        case window.NPlayer.PlayState.Paused:\n          player.setVisible(true);\n\n          if (setAxPlugin === true) {\n            window.AquaAxPlugin.PlayState = window.NPlayer.PlayState.Paused;\n            window.AquaAxPlugin.OpenStateChange();\n          }\n          break;\n        }\n      });\n\n      player.bindEvent(\"GuardCallback\", function(name, desc) {\n        if (setAxPlugin === true) window.AquaAxPlugin.SendPVLog(name, desc);\n      });\n\n      player.bindEvent(\"Error\", function(ec) {\n        console.log(\"err\", ec);\n        $(\"#video\").css(\"background-image\", \"none\");\n      });\n\n      player.bindEvent(\"ContextMenu\", function(val) {\n        if (val === \"sysinfo\") {\n          if (setAxPlugin === true) {\n            window.AquaAxPlugin.LoadSystemInfomation();\n            window.alert(\n              \"CPU 정보 : \" +\n                window.AquaAxPlugin.DeviceCPU +\n                \"\\n\" +\n                \"MEM 정보 : \" +\n                window.AquaAxPlugin.DeviceMem +\n                \"\\n\" +\n                \"GPU 정보 : \" +\n                window.AquaAxPlugin.DeviceGPU +\n                \"\\n\\n\" +\n                \"IP 정보 : \" +\n                window.AquaAxPlugin.DeviceIP +\n                \"\\n\" +\n                \"Mac 정보 : \" +\n                window.AquaAxPlugin.DeviceMac +\n                \"\\n\" +\n                \"OS 정보 : \" +\n                window.AquaAxPlugin.DeviceOSDesc +\n                \"\\n\" +\n                \"해상도 정보 : \" +\n                window.AquaAxPlugin.DeviceMonitor +\n                \"\\n\" +\n                \"IE 버전 : \" +\n                window.AquaAxPlugin.DeviceIE +\n                \"\\n\"\n            );\n          }\n        }\n      });\n\n      window.onunload = function() {\n        if (setAxPlugin === true) window.AquaAxPlugin.FinalizeAuth();\n      };\n    },\n    // encparam 을 서버에서 생성하여 전달받는다.\n    getEncodedParam: function() {\n      window.axios\n        .get(\"/api/v1/player/encparam\")\n        .then(function(res) {\n          encodedParam = res.data.encparam;\n          // self.reportMessage(encodedParam);\n          self.initPlayer();\n        })\n        .catch(function(err) {\n          self.reportError(err);\n        });\n    },\n    reportMessage: function(msg) {\n      console.log(\"aquaservice : \" + msg);\n    },\n    reportError: function(err) {\n      console.log(\"aquaservice : \" + err);\n    },\n    resize: function() {\n      $(window).resize(function() {\n        $(\"#video\").height($(window).height() - $(\".wrapper_foot\").height());\n        // if (window.player && !window.player.getFullscreen()) {\n        //   console.log('resized-1');\n        //   $('#video').height($(window).height());\n        // } else {\n        //   console.log('resized-2');\n        //   $('#video').height($(window).height() - $('.wrapper_foot').height());\n        // }\n      });\n    },\n    testWatermark() {\n      window.player.setWatermarkText(self.options.watermark);\n      window.player.setWatermarkSize(15);\n      window.player.setWatermarkColor(255, 0, 0, 0.5);\n      window.player.setWatermarkInterval(5);\n      window.player.setWatermarkLocation(22);\n    },\n    testSubtitle: function() {\n      self.testSubtitle1();\n    },\n    testSubtitle1: function() {\n      window.setTimeout(function() {\n        window.player.setSubtitleFont(\"궁서\", 25);\n        window.player.setSubtitleColor(255, 0, 0, 0.5);\n        window.player.setSubtitlePosition(100, 100);\n        window.player.setSubtitleText(\"Hello, World - 테스트 1\");\n        self.testSubtitle2();\n      }, 1000);\n    },\n    testSubtitle2: function() {\n      window.setTimeout(function() {\n        window.player.setSubtitleFont(\"Malgun Gothic\", 15);\n        window.player.setSubtitleColor(0, 255, 0, 1);\n        window.player.setSubtitlePosition(200, 50);\n        window.player.setSubtitleText(\"Hello, World - 테스트 2\");\n        self.testSubtitle3();\n      }, 1000);\n    },\n    testSubtitle3() {\n      window.setTimeout(function() {\n        window.player.setSubtitleFont(\"굴림\", 35);\n        window.player.setSubtitleColor(0, 0, 255, 0.7);\n        window.player.setSubtitlePosition(50, 200);\n        window.player.setSubtitleText(\"Hello, World - 테스트 3\");\n        self.testSubtitle1();\n      }, 1000);\n    }\n  };\n\n  return AquaPlayerService;\n});\n"],"sourceRoot":"/source/"}