{"version":3,"sources":["components/fine_uploader_service.js"],"names":["window","define","$","axios","qq","qqTemplate","FineUploaderService","options","extend","self","a","prototype","b","key","hasOwnProperty","extendOptions","getUploadInfo","this","init","data","get","then","response","uploadInfo","uploadUrl","replace","uploadCancelUrl","token","uploader","setFineUploader","cors","allowXdr","append","expected","FineUploader","element","document","getElementById","el","validation","allowedExtensions","mutiple","itemLimit","stopOnFirstInvalidFile","endpoint","inputName","paramsInBody","params","target_path","callbacks","onComplete","uploadStoredFiles","name","responseJSON","xhr","$messages","attach","autoUpload","multiple","FineUploaderBasic","button","$fub","onSubmit","onProgress","id","fileName","loaded","removeClass","addClass","html","total","progress","Math","round","success","error","debug"],"mappings":"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","file":"components/fine_uploader_service.js","sourcesContent":["\"use strict\";\n\nwindow.define(\n  [\n    \"jquery\",\n    \"axios\",\n    \"fineUploader\", // fineUploaderCore\n    \"text!../../fine_uploader.html\"\n  ],\n  function($, axios, qq, qqTemplate) {\n    var self;\n    var uploader;\n\n    function FineUploaderService(options) {\n      self = this;\n\n      self.extendOptions(options);\n      self.init();\n    }\n\n    FineUploaderService.prototype = {\n      // 옵션 저장 변수\n      options: {},\n      extend: function(a, b) {\n        for (var key in b) {\n          if (b.hasOwnProperty(key)) {\n            a[key] = b[key];\n          }\n        }\n        return a;\n      },\n      // 옵션 확장\n      extendOptions: function(options) {\n        this.options = this.extend({}, this.options);\n        this.extend(this.options, options);\n      },\n      // 컴포넌트 초기화\n      init: function() {\n        self.getUploadInfo();\n      },\n      getUploadInfo: function() {\n        axios.get(\"/api/v1/fineuploader/token\").then(function(response) {\n          var data = response.data.uploadInfo;\n          if (data) {\n            self.options.uploadUrl = data.uploadUrl.replace(\"v4\", \"cdnovp\");\n            self.options.uploadCancelUrl = data.uploadCancelUrl;\n            self.options.token = data.token;\n\n            // self.setFineUploaderBasic();\n            self.setFineUploader();\n          }\n        });\n      },\n      setFineUploader: function() {\n        $(\"#uploader-template\").append(qqTemplate);\n        uploader = new qq.FineUploader({\n          element: document.getElementById(self.options.el),\n          autoUpload: false,\n          multiple: self.options.mutiple,\n          cors: {\n            allowXdr: true,\n            expected: true\n          },\n          validation: {\n            allowedExtensions: [\"avi\", \"mp4\"],\n            itemLimit: 3,\n            stopOnFirstInvalidFile: true\n          },\n          request: {\n            endpoint: self.options.uploadUrl + \"?token=\" + self.options.token,\n            inputName: \"videofile\",\n            paramsInBody: true,\n            params: {\n              token: self.options.token,\n              target_path: \"/dev\"\n            }\n          },\n          callbacks: {\n            onComplete: function(id, name, responseJSON, xhr) {\n              // console.log(responseJSON);\n            }\n          }\n        });\n        qq(document.getElementById(\"upload-button\")).attach(\"click\", function() {\n          uploader.uploadStoredFiles();\n        });\n      },\n      setFineUploaderBasic: function() {\n        var $fub = $(\"#fine-uploader-basic\");\n        var $messages = $(\"#messages\");\n\n        uploader = new qq.FineUploaderBasic({\n          button: $fub[0],\n          autoUpload: false,\n          multiple: self.options.mutiple,\n          cors: {\n            allowXdr: true,\n            expected: true\n          },\n          validation: {\n            allowedExtensions: [\"avi\", \"mp4\"],\n            itemLimit: 3,\n            stopOnFirstInvalidFile: true\n          },\n          request: {\n            endpoint: self.options.uploadUrl,\n            inputName: \"videofile\",\n            paramsInBody: false,\n            params: {\n              token: self.options.token,\n              target_path: \"/dev\"\n            }\n          },\n          callbacks: {\n            onSubmit: function(id, fileName) {\n              $messages.append(\"<div id=\\\"file-\" + id + \"\\\" class=\\\"alert\\\" style=\\\"margin: 20px 0 0\\\"></div>\");\n            },\n            onUpload: function(id, fileName) {\n              $(\"#file-\" + id)\n                .addClass(\"alert-info\")\n                .html(\n                  \"<img src=\\\"/static/stylesheets/images/loading.gif\\\" alt=\\\"Initializing. Please hold.\\\"> \" +\n                    \"Initializing \" +\n                    \"“\" +\n                    fileName +\n                    \"”\"\n                );\n            },\n            onProgress: function(id, fileName, loaded, total) {\n              if (loaded < total) {\n                var progress = Math.round((loaded / total) * 100) + \"% of \" + Math.round(total / 1024) + \" kB\";\n                $(\"#file-\" + id)\n                  .removeClass(\"alert-info\")\n                  .html(\n                    \"<img src=\\\"/static/stylesheets/images/loading.gif\\\" alt=\\\"In progress. Please hold.\\\"> \" +\n                      \"Uploading \" +\n                      \"“\" +\n                      fileName +\n                      \"” \" +\n                      progress\n                  );\n              } else {\n                $(\"#file-\" + id)\n                  .addClass(\"alert-info\")\n                  .html(\n                    \"<img src=\\\"/static/stylesheets/images/loading.gif\\\" alt=\\\"Saving. Please hold.\\\"> \" +\n                      \"Saving \" +\n                      \"“\" +\n                      fileName +\n                      \"”\"\n                  );\n              }\n            },\n            onComplete: function(id, fileName, responseJSON) {\n              if (responseJSON.success) {\n                $(\"#file-\" + id)\n                  .removeClass(\"alert-info\")\n                  .addClass(\"alert-success\")\n                  .html(\n                    \"<i class=\\\"icon-ok\\\"></i> \" +\n                      \"Successfully saved \" +\n                      \"“\" +\n                      fileName +\n                      \"”\" +\n                      \"<br><img src=\\\"img/success.jpg\\\" alt=\\\"\" +\n                      fileName +\n                      \"\\\">\"\n                  );\n              } else {\n                $(\"#file-\" + id)\n                  .removeClass(\"alert-info\")\n                  .addClass(\"alert-error\")\n                  .html(\n                    \"<i class=\\\"icon-exclamation-sign\\\"></i> \" +\n                      \"Error with \" +\n                      \"“\" +\n                      fileName +\n                      \"”: \" +\n                      responseJSON.error\n                  );\n              }\n            }\n          },\n          debug: true\n        });\n\n        qq(document.getElementById(\"upload-button\")).attach(\"click\", function() {\n          uploader.uploadStoredFiles();\n        });\n      }\n    };\n\n    return FineUploaderService;\n  }\n);\n"],"sourceRoot":"/source/"}