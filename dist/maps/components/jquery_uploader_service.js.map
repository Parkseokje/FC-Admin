{"version":3,"sources":["components/jquery_uploader_service.js"],"names":["window","define","Util","JqueryFileUploaderService","options","self","this","extendOptions","init","jqXHR","$","axios","prototype","extend","a","b","key","hasOwnProperty","getUploadInfo","attr","get","then","response","data","uploadUrl","uploadInfo","replace","uploadCancelUrl","token","deploy_package_id","folder_id","setJqueryFileUploader","cancelUpload","alert","location","reload","catch","error","console","log","formData","append","uploadFolder","autoUpload","fileupload","acceptFileTypes","replaceFileInput","add","e","submit","responseJSON","callback","errorMessage","errorCode","modal","errorInfo","progressall","progress","parseInt","loaded","total","html","each","css","bind","on","abort","index","file","val","name","errorThrown"],"mappings":"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","file":"components/jquery_uploader_service.js","sourcesContent":["\"use strict\";\n\nwindow.define([\"common\", \"jquery.iframe-transport\", \"jquery-ui/ui/widget\", \"jquery.fileupload\"], function(Util) {\n  var self;\n  var $ = $ || window.$;\n  var axios = axios || window.axios;\n  var jqXHR;\n\n  function JqueryFileUploaderService(options) {\n    self = this;\n\n    self.extendOptions(options);\n    self.init();\n  }\n\n  JqueryFileUploaderService.prototype = {\n    // 옵션 저장 변수\n    options: {},\n    extend: function(a, b) {\n      for (var key in b) {\n        if (b.hasOwnProperty(key)) {\n          a[key] = b[key];\n        }\n      }\n      return a;\n    },\n    // 옵션 확장\n    extendOptions: function(options) {\n      this.options = this.extend({}, this.options);\n      this.extend(this.options, options);\n    },\n    // 컴포넌트 초기화\n    init: function() {\n      self.getUploadInfo();\n      $(\"#cancel-button\").attr(\"disabled\", true);\n    },\n    getUploadInfo: function() {\n      axios.get(\"/api/v1/fineuploader/token\").then(function(response) {\n        var data = response.data;\n        if (data) {\n          self.options.uploadUrl = data.uploadInfo.uploadUrl.replace(\"v4\", \"cdnovp\");\n          self.options.uploadCancelUrl = data.uploadInfo.uploadCancelUrl;\n          self.options.token = data.uploadInfo.token;\n          self.options.deploy_package_id = data.deploy_package_id;\n          self.options.folder_id = data.folder_id;\n\n          // console.log(data);\n\n          self.setJqueryFileUploader();\n        }\n      });\n    },\n    // 업로드를 취소한다.\n    cancelUpload: function() {\n      axios\n        .post(self.options.uploadCancelUrl + \"?token=\" + self.options.token, {\n          token: self.options.token\n        })\n        .then(function(response) {\n          window.alert(\"업로드 취소\");\n          window.location.reload();\n          // $('#upload-button').attr('disabled', false);\n          // $('#cancel-button').attr('disabled', true);\n\n          // $('#fileupload').fileupload('destroy');\n          // $('#fileupload').val('');\n\n          // self.getUploadInfo();\n        })\n        .catch(function(error) {\n          console.log(error);\n        });\n    },\n    setJqueryFileUploader: function() {\n      console.log(self.options);\n\n      $(\"#fileupload\").attr(\"data-url\", self.options.uploadUrl + \"?token=\" + self.options.token);\n\n      var formData = new window.FormData();\n      formData.append(\"token\", self.options.token);\n      formData.append(\"folder\", self.options.folder_id);\n      formData.append(\"pkg\", self.options.deploy_package_id);\n      // formData.append('folder', 2004661);\n      // formData.append('pkg', 1006241);\n      formData.append(\"target_path\", self.options.uploadFolder);\n      // formData.append('videofile', $('#fileupload').get(0).files[0], '123.mp4');\n\n      $(\"#fileupload\").fileupload({\n        dataType: \"json\",\n        singleFileUploads: true,\n        autoUpload: false,\n        acceptFileTypes: /(\\.|\\/)(mp4|avi)$/i,\n        formData: formData,\n        replaceFileInput: false,\n        add: function(e, data) {\n          $(\"#upload-button\")\n            .off(\"click\")\n            .on(\"click\", function() {\n              $(\"#upload-button\").attr(\"disabled\", true);\n              $(\"#cancel-button\").attr(\"disabled\", false);\n\n              console.log(data);\n              jqXHR = data.submit();\n            });\n        },\n        done: function(e, data) {\n          var responseJSON = data.jqXHR.responseJSON;\n\n          if (responseJSON.uploadInfo.errorInfo.errorCode === \"None\") {\n            window.alert(\"업로드 성공\");\n            $(\"#fineUploader\").modal(\"hide\");\n            self.options.callback(data);\n          } else {\n            window.alert(responseJSON.uploadInfo.errorInfo.errorMessage);\n          }\n\n          $(\"#upload-button\").attr(\"disabled\", false);\n          $(\"#cancel-button\").attr(\"disabled\", true);\n        },\n        progressall: function(e, data) {\n          var progress = parseInt((data.loaded / data.total) * 100, 10);\n          $(\"#progress-value\").html(progress + \"%\");\n          $(\"#progress .jquery-file-progress-bar\").css(\"width\", progress + \"%\");\n        }\n      });\n\n      $(\"#fileupload\").bind(\"fileuploadadd\", function(e, data) {\n        $.each(data.files, function(index, file) {\n          $(\"#aqua-video-code\").val(\"onm_\" + file.name);\n        });\n\n        $(\"#cancel-button\").on(\"click\", function(e) {\n          jqXHR.abort();\n        });\n      });\n\n      $(\"#fileupload\").bind(\"fileuploadfail\", function(e, data) {\n        if (data.errorThrown === \"abort\") {\n          self.cancelUpload();\n        }\n      });\n\n      $(\"#fileupload\").bind(\"fileuploadsubmit\", function(e, data) {\n        // var formData = [\n        //   { name: 'token', value: self.options.token },\n        //   { name: 'folder', value: 2004661 },\n        //   { name: 'pkg', value: 1006241 },\n        //   { name: 'target_path', value: self.options.uploadFolder },\n        //   { name: 'videofile', value: $('#fileupload').get(0).files[0], filename: '123.mp4' }\n        // ];\n        // data.formData = formData;\n        // console.log(data.formData);\n        // data.formData.set('videofile', $('#fileupload').get(0).files[0], '123.mp4');\n      });\n    }\n  };\n\n  return JqueryFileUploaderService;\n});\n"],"sourceRoot":"/source/"}