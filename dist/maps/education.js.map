{"version":3,"sources":["education.js"],"names":["requirejs","selectCourseList","course_name","element","find","val","text","duplicated_item","$","course_id","length","show","courseContainer","append","deleteEduCourse","course","remove","order","mode","valid_course_count","each","index","this","data","course_group","is","course_group_list","btnCreateEdu","Util","initDataTable","handle","sortable","forcePlaceholderSize","zIndex","start","attr","e","ui","update","item","oldIndex","newIndex","removeAttr","console","log","btnAddCourse","bind","addCourseGroupItem","on","target","parent","modal","edu_name","edu_desc","tinymce","first","makeCourseGroupList","alert","focus","confirm","method","url","name","desc","trim","then","success","window","location","reload"],"mappings":"AAAA,YACAA,YAAAA,UAKI,SAAIC,GA6DF,QAAIC,KACJ,GAAIC,GAAJF,EAAAG,KAAA,mBAAAC,MADIH,EAAcD,EAAiBG,KAAK,mBAAmBE,OAG3DH,EAAA,GAGEI,EAAAC,EAAA,oCAAAC,EAAA,MACA,IAAAF,EAAAG,OAAA,MACDH,GAAAI,QADQ,CAKTR,IAAW,+CAAXM,EAAA,KACAN,GAAW,2BACXA,GAAW,mDACXA,GAAW,+CACXA,GAAWD,+CACXC,GAAW,kBACXA,GAAWD,EACXC,GAAW,iDACXA,GAAW,oDACXA,GAAW,eADXA,GAAW,aAGXS,GAAAA,QAAAA,EAAgBC,OAAOV,GAgBxB,QAAAW,GAAAC,GADCA,EAAOC,SAMP,QAAIC,KACJ,GAAIC,MACAC,EAAAA,EAEFA,EAAuBf,CA0BvBe,OAxBEV,GAAAA,uBAAWL,KAAa,sBADPgB,KAAA,SAAAC,GAEjBJ,GAAAA,IAFFR,UAAAD,EAAAc,MAAAC,KAAA,aAEEN,MAAOA,EAKLO,GAAaN,GADfV,EAEOc,MAAAG,GAAA,YACLD,EAAaN,KAAO,SAJxBM,EAMON,KAAA,SACLM,EAAaN,KAAO,SAKtBQ,EAAiBR,KAAbM,GAEF,WAAAP,EAAAC,OACDC,GAAA,EArBHF,GAAA,MAwBAM,KAAAG,EAIDP,mBAAAA,GAxID,GAAIP,GAAAA,EAAkBJ,uBAClBmB,EAAiBnB,EAAA,uBADjBI,EAAkBJ,EAAE,uBAGtBmB,EAAYnB,EAAA,8BAEZA,GAAA,WA6BAoB,EAAAC,cAAArB,EAAA,qBAGEsB,EAAAA,uBAFgCC,UAGhCC,YAAAA,iBACAC,OAAQ,UACRC,sBAAO,EACL1B,OAAQ2B,OANsBD,MAAA,SAAAE,EAAAC,GAQhCC,EAAAA,MAAQH,KAAA,iBAAiBE,EAAAE,KAAAlB,UAEvBiB,OAAIE,SAAaJ,EAAFC,GACb,GAAFI,GAAQC,EAAWH,KAAAlB,QACnBsB,EAAYnC,EAAAc,MAAAa,KAAgBM,iBAC7BjC,GAAAc,MAAAoB,WAAA,kBAbHC,QAAAC,IAAA,cAAAH,EAAA,eAAAD,QAkBFK,EAAAC,KAAA,QAAA,WACEC,MAmCFnC,EAAAoC,GAAA,QAAA,OAAA,SAAAZ,GAGAtB,EAAAN,EAAA4B,EAAAa,QAAAC,SAAAA,SAAAA,YACA1C,EAAA,sBAAAsC,KAAA,QAAA,WACEhC,EAAgBN,EAAEc,MAAM4B,SAASA,YA6CnCvB,EAAamB,KAAK,QAAS,SAAUV,GAGnCA,EAAIe,gBAAJ,IAEgDC,IAA9CC,EAAWC,qBAAmC9C,EAAA,gBAAA+C,SAC9C7B,EAAAA,QAAoB8B,aAAAA,aAApB9B,EAAoB8B,GAGpBC,OAAA,KAAAA,EAAMpD,OACN+C,MAAAA,iBACAA,EAAOM,SACR,GAGO,KAAND,GACAJ,MAAAA,oBACAA,EAAOK,SACR,GAGCD,EAAAtC,qBAKAwC,QAAA,kBAKAC,QACAC,OAAK,OACLtC,IAAM,wBACJuC,MACAC,KAAMV,EAAUhD,MAAA2D,OAChBtC,KAAAA,EACAA,kBAAAA,EAAAH,QAIF0C,KAAQ1C,SAAK2C,GACX,GAAAT,EAAMlC,KAAA2C,QADRT,MAEO,kBAENA,MAAA,uCAfHU,OAAAC,SAAAC,YAREZ,MAAO,gBACR","file":"education.js","sourcesContent":["\"use strict\";\nrequirejs([\n  \"common\"\n],\n  function (Util) {\n    var btnAddCourse = $(\".btn-add-course-edu\");\n    var selectCourseList = $(\"#select-course-list\");\n    var courseContainer = $(\"#draggablePanelList\");\n    var btnCreateEdu = $(\".btn-register-course-submit\");\n\n    $(function () {\n      // DateTimePicker 설정\n      // var startDt = moment().format();\n      // var endDt = moment().add(6, 'days');\n\n      // 교육 시작일자\n      // $('#start_dt').datetimepicker({\n      //   defaultDate: startDt,\n      //   format: 'YYYY-MM-DD',\n      //   showTodayButton: true\n      // });\n\n      // // 교육 종료일자\n      // $('#end_dt').datetimepicker({\n      //   defaultDate: endDt,\n      //   format: 'YYYY-MM-DD',\n      //   useCurrent: false,\n      //   showTodayButton: true\n      // });\n\n      // // 날짜가 서로 겹치지 않도록 설정한다.\n      // $('#start_dt').on('dp.change', function (e) {\n      //   $('#end_dt').data('DateTimePicker').minDate(e.date);\n      // });\n      // $('#end_dt').on('dp.change', function (e) {\n      //   $('#start_dt').data('DateTimePicker').maxDate(e.date);\n      // });\n\n      // datatable 설정\n      Util.initDataTable($(\"#table_education\"));\n\n      // jQuery UI sortable 초기화\n      $(\"#draggablePanelList\").sortable({\n        placeholder: \"sort-highlight\",\n        handle: \".handle\",\n        forcePlaceholderSize: true,\n        zIndex: 999999,\n        start: function (e, ui) {\n          $(this).attr(\"data-previndex\", ui.item.index());\n        },\n        update: function (e, ui) {\n          var newIndex = ui.item.index();\n          var oldIndex = $(this).attr(\"data-previndex\");\n          $(this).removeAttr(\"data-previndex\");\n          console.log(\"newIndex : \" + newIndex + \" oldIndex : \" + oldIndex);\n        }\n      });\n    });\n\n    // 강의 추가\n    btnAddCourse.bind(\"click\", function () {\n      addCourseGroupItem();\n    });\n\n    // 강의를 그룹에 추가한다.\n    function addCourseGroupItem() {\n      var course_id = selectCourseList.find(\"option:selected\").val();\n      var course_name = selectCourseList.find(\"option:selected\").text();\n      var element = \"\";\n\n      // 강의 중복추가 방지\n      var duplicated_item = $(\".list-group-item[data-course-id=\\\"\" + course_id + \"\\\" ]\");\n      if (duplicated_item.length) {\n        duplicated_item.show();\n        return false;\n      }\n\n      element += \"<li class=\\\"list-group-item\\\" data-course-id=\\\"\" + course_id + \"\\\">\";\n      element += \"    <div class=\\\"course\\\">\";\n      element += \"        <span class=\\\"handle ui-sortable-handle\\\">\";\n      element += \"            <i class=\\\"fa fa-ellipsis-v\\\"></i>\";\n      element += \"            <i class=\\\"fa fa-ellipsis-v\\\"></i>\";\n      element += \"        </span>\";\n      element += course_name;\n      element += \"        <a href=\\\"#\\\" class=\\\"btn-delete-course\\\">\";\n      element += \"            <i class=\\\"fa fa-remove text-red\\\"></i>\";\n      element += \"        </a>\";\n      element += \"    </div>\";\n      element += \"</li>\";\n\n      courseContainer.append(element);\n    }\n\n    /**\n     * 동적으로 추가된 강의에 이벤트 바인딩\n     */\n    courseContainer.on(\"click\", \"> li\", function (e) {\n      deleteEduCourse($(e.target).parent().parent().parent());\n    });\n    // 강의 삭제\n    $(\".btn-delete-course\").bind(\"click\", function () {\n      deleteEduCourse($(this).parent().parent());\n    });\n\n    function deleteEduCourse(course) {\n      course.remove();\n    }\n\n    // 강의그룹 데이터를 생성한다.\n    function makeCourseGroupList() {\n      var course_group_list = [];\n      var order = 0;\n      var mode = \"\";\n      var valid_course_count = 0;\n\n      $(\"#draggablePanelList\").find(\"li.list-group-item\").each(function (index) {\n        var course_group = {\n          course_id: $(this).data(\"course-id\"),\n          order: order\n        };\n\n        if (course_group.id) {\n          if ($(this).is(\":visible\")) {\n            course_group.mode = \"UPDATE\";\n          } else {\n            course_group.mode = \"DELETE\";\n          }\n        } else {\n          course_group.mode = \"INSERT\";\n        }\n\n        course_group_list.push(course_group);\n\n        if (course_group.mode !== \"DELETE\") {\n          valid_course_count += 1;\n          order += 1;\n        }\n      });\n\n      return {\n        data: course_group_list,\n        valid_course_count: valid_course_count\n      };\n    }\n\n    // 교육과정 등록\n    btnCreateEdu.bind(\"click\", function (e) {\n      e.preventDefault();\n\n      var modal = $(\"#frm_register_edu\"),\n        edu_name = $(\".course-name\").first(),\n        edu_desc = tinymce.activeEditor.getContent(), // $('.course-desc');\n        course_group_list = makeCourseGroupList();\n\n      if (edu_name.val() === \"\") {\n        alert(\"교육과정명을 입력하세요.\");\n        edu_name.focus();\n        return false;\n      }\n\n      if (edu_desc === \"\") {\n        alert(\"교육과정 소개를 입력해주세요.\");\n        edu_desc.focus();\n        return false;\n      }\n\n      if (!course_group_list.valid_course_count) {\n        alert(\"강의를 추가해주세요.\");\n        return false;\n      }\n\n      if (!confirm(\"등록하시겠습니까?\")) {\n        return false;\n      }\n\n      // 저장한다.\n      axios({\n        method: \"post\",\n        url: \"/education/create/edu\",\n        data: {\n          name: edu_name.val().trim(),\n          desc: edu_desc, // edu_desc.val().trim(),\n          course_group_list: course_group_list.data\n          // start_dt: $('#start_dt').find('input').val() + ' ' + '00:00:00',\n          // end_dt: $('#end_dt').find('input').val() + ' ' + '23:59:59'\n        }\n      }).then(function (res) {\n        if (res.data.success == true) {\n          alert(\"교육과정을 등록하였습니다.\");\n        } else {\n          alert(\"알 수 없는 오류가 발생했습니다. 잠시 후에 다시 시도해주세요.\");\n        }\n\n        window.location.reload();\n      });\n    });\n  }); // end of func\n"],"sourceRoot":"/source/"}