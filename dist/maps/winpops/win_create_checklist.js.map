{"version":3,"sources":["winpops/win_create_checklist.js"],"names":["window","requirejs","btnSaveChecklist","tableChecklist","$","find","items","placeholder","not","focus","handle","sortable","forcePlaceholderSize","zIndex","start","update","e","ui","this","attr","item","index","removeAttr","setRowNo","$row","$itemType","closest","$sample","$item","val","$category","alert","$clone","clone","html","length","hide","show","after","on","confirm","remove","$selected","parent","click","$desc","rows","$title","trim","each","itemId","data","item_type","item_section","item_name","sample","i","order","checklist_group_id","title","desc","format","itemArray","then","catch","closeWindow","error","console","row","opener","winpop_listener","close"],"mappings":"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","file":"winpops/win_create_checklist.js","sourcesContent":["'use strict';\nwindow.requirejs(\n  [\n    'common'\n  ],\nfunction (Util) {\n  // var btnAddItem = window.$('.additem');\n  var tableChecklist = window.$('#table_checklist');\n  var btnSaveChecklist = window.$('#regist-quiz');\n  var $ = $ || window.$;\n\n  window.$(function () {\n    tableChecklist.find('tr:first-child').not('thead tr').find('input[name=\"item\"]').focus();\n    tableChecklist.find('tbody').sortable({\n      items: 'tr:not(:first)',\n      placeholder: 'sort-highlight',\n      handle: '.handle',\n      forcePlaceholderSize: true,\n      zIndex: 999999,\n      start: function (e, ui) {\n        window.$(this).attr('data-previndex', ui.item.index());\n      },\n      update: function (e, ui) {\n        // var newIndex = ui.item.index();\n        // var oldIndex = window.$(this).attr('data-previndex');\n        window.$(this).removeAttr('data-previndex');\n        setRowNo();\n        // console.log('newIndex : ' + newIndex + ' oldIndex : ' + oldIndex);\n      }\n    });\n  });\n\n  /**\n   * 행추가\n   */\n  tableChecklist.on('click', '.additem', function (e) {\n    var $row = window.$(this).closest('.item');\n    var $category = $row.find('input[name=\"category\"]');\n    var $item = $row.find('input[name=\"item\"]');\n    var $itemType = $row.find('.itemtype');\n    var $sample = $row.find('.sample');\n\n    if ($itemType.val() !== 'write') {\n      if ($category.val() === '') {\n        window.alert('분류를 입력하세요.');\n        $category.focus();\n        return false;\n      }\n    }\n\n    if ($item.val() === '') {\n      window.alert('체크사항을 입력하세요.');\n      $item.focus();\n      return false;\n    }\n\n    var $clone = $row.clone();\n\n    $clone.find('.itemno').html(tableChecklist.find('tr').not(':first').length);\n    $clone.find('#item').attr('placeholder', '');\n    $clone.find('.itemtype').val($itemType.val());\n    $clone.find('.additem').hide();\n    $clone.find('.removeitem').show();\n\n    tableChecklist.find('tbody').find('tr:last').after($clone);\n\n    // $itemType.val('select'); // 선택형\n    $category.show();\n    $sample.show();\n    $item.val('');\n    $item.focus();\n  });\n\n  /**\n   * 행삭제\n   */\n  tableChecklist.on('click', '.removeitem', function () {\n    var $row = window.$(this).closest('.item');\n    if (window.confirm('삭제하시겠습니까?')) {\n      $row.remove();\n    }\n  });\n\n  tableChecklist.on('change', '.itemtype', function (e) {\n    var $row = window.$(this).closest('.item');\n    var $selected = window.$(this);\n    var $item = $row.find('input[name=\"item\"]');\n    var $category = $row.find('input[name=\"category\"]');\n    var $sample = $row.find('.sample');\n\n    switch ($selected.val()) {\n    case 'write':\n      $category.hide();\n      $sample.hide();\n      break;\n    default:\n      $category.show();\n      $sample.show();\n      break;\n    }\n\n    $item.select();\n  });\n\n  tableChecklist.on('keypress', '.inputitem', function (e) {\n    if (e.which === 13) {\n      var $row = window.$(this).parent().closest('.item');\n      if ($row.index() === 0) {\n        $row.find('.additem').click();\n      }\n    }\n  });\n\n  /**\n   * 자료 저장하기\n   */\n  btnSaveChecklist.on('click', function () {\n    var itemArray = [];\n    var rows = tableChecklist.find('tr').not(':first');\n    var $title = window.$('input[name=title]');\n    var $desc = $('#desc').val(); // window.tinymce.activeEditor.getContent();\n\n    if ($title.val().trim() === '') {\n      window.alert('대표제목을 입력하세요.');\n      $title.focus();\n      return false;\n    }\n\n    rows.each(function (i, row) {\n      if (i === 0) return true;\n      var $row = window.$(row);\n      var itemId = $row.data('id');\n      var $itemType = $row.find('.itemtype');\n      var $item = $row.find('input[name=\"item\"]');\n      var $category = $row.find('input[name=\"category\"]');\n      var $sample = $row.find('input[name=\"sample\"]');\n\n      // 체크사항 빈값여부 검사\n      if ($item.val() === '') {\n        window.alert('체크사항을 입력하세요.');\n        $item.focus();\n        return false;\n      }\n      // 보기 빈값여부 검사\n      if ($itemType.val() === 'select' || $itemType.val() === 'choose') {\n        if ($sample.val() === '') {\n          window.alert('보기를 입력하세요.');\n          $sample.focus();\n          return false;\n        }\n      }\n\n      itemArray.push({\n        id: itemId,\n        item_name: $item.val(),\n        item_type: $itemType.val(),\n        item_section: (function () {\n          if ($itemType.val() !== 'write') {\n            return $category.val();\n          } else {\n            return '';\n          }\n        }()),\n        sample: (function () {\n          if ($itemType.val() !== 'write') {\n            return $sample.val();\n          } else {\n            return '';\n          }\n        }()),\n        order: i\n      });\n    });\n\n    // console.log(itemArray);\n    window.axios.post('/course/checklist', {\n      course_id: window.$('input[name=course_id]').val(),\n      course_list_id: null,\n      checklist_group_id: null,\n      order: null,\n      title: window.$('input[name=title]').val(),\n      desc: window.tinymce.get('desc').getContent({\n        format: 'raw'\n      }),\n      data: itemArray\n    })\n    .then((response) => {\n      // console.log(response);\n      window.alert('자료를 입력하였습니다.');\n      closeWindow();\n    })\n    .catch((error) => {\n      console.error(error);\n    });\n  });\n\n  /**\n   * 번호를 다시 매긴다.\n   */\n  const setRowNo = () => {\n    var rows = tableChecklist.find('tr').not(':first');\n    rows.each(function (i, row) {\n      if (i === 0) return true;\n      var $row = window.$(row);\n      $row.find('.itemno').html(i);\n    });\n  };\n\n  const closeWindow = () => {\n    // window.parent.opener.location.reload();\n    window.parent.opener.winpop_listener(true);\n    window.close();\n  };\n});\n\n"],"sourceRoot":"/source/"}