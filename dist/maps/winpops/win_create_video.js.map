{"version":3,"sources":["winpops/win_create_video.js"],"names":["window","requirejs","$btnRegistVideo","validateForm","videoTitle","$","val","alert","focus","$videoCode","videoProvider","displayVideo","videoCode","videoPlayer","html","$btnUploadVideo","$selectVideoProvider","$setAquaPlayer","$setVimeoPlayer","tableVideos","Util","initDataTable","$btnChangeVideo","$encodingProgress","buttons","$fileUpload","options","uploadFolder","callback","data","success","JqueryFormUploaderService","change","bind","get","files","name","e","preventDefault","fileName","replace","search","videoInfo","undefined","rows","nodes","$aquaPlayerFrame","attr","modal","url","getOSName","id","removeClass","addClass","option","on","which","keyCode","$btnPlayVideo","confirm","axios","post","course_id","video_name","video_code","then","opener","winpop_listener","parent","catch","error","console","log","onbeforeunload","event"],"mappings":"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","file":"winpops/win_create_video.js","sourcesContent":["\"use strict\";\n\nwindow.requirejs([\n  \"common\",\n  \"Vimeo\",\n  // 'jqueryUploaderService',\n  \"jqueryFormUploaderService\"\n],\nfunction (Util, Vimeo, JqueryFormUploaderService) {\n  var $ = $ || window.$;\n  // var player = null;\n  // var playerContainer = $('#videoplayer');\n  var $btnRegistVideo = $(\"#regist-video\");\n  var $btnUploadVideo = $(\"#uploadVideo\");\n  var $btnPlayVideo = $(\"#play-video\");\n  // var _confirm = true; // 윈도우 종료 시 창을 닫을지 여부\n  var $selectVideoProvider = $(\"#video-provider\");\n  var $setAquaPlayer = $(\".aquaplayer-settings\");\n  var $setVimeoPlayer = $(\".vimeo-settings\");\n  var $aquaPlayerFrame = $(\"#aquaplayer_frame\");\n  // datatable 설정\n  var tableVideos = Util.initDataTable($(\"#table_add_video\"), { buttons: [] });\n  var $btnChangeVideo = $(\"#btnApplyVideo\");\n  var $encodingProgress = $(\".encoding-progress\");\n  var $fileUpload = $(\"#fileupload\");\n\n  window.$(function () {\n    // $btnRegistVideo.button('loading');\n    // setTimeout(function () {\n    //   $btnRegistVideo.button('reset');\n    // }, 3000);\n\n    // console.log('hello!');\n    // window.alert(window.parent.opener);\n    // window.parent.opener.winpop_listener();\n\n    // $aquaPlayerFrame.attr('src', '/api/v1/aqua?os=' + Util.getOSName() + '&video_id=148');\n\n    // 영상 업로더 초기화\n    var options = {\n      uploadFolder: $(\"#upload_folder\").val(),\n      callback: function (data) {\n        if (data.success) {\n          // $encodingProgress.removeClass('blind');\n\n          // var EncodingChecker;\n\n          // // 인코딩 상태를 체크한다.\n          // (function checkEncodingStatus () {\n          //   window.axios.get('http://api.wecandeo.com/web/encoding/status.json?' +\n          //     'key=' + data.token +\n          //     '&access_key=' + data.access_key +\n          //     '&pkg=' + data.pkg\n          //   )\n          //   .then(function (response) {\n          //     var data = response.data;\n\n          //     if (data.encodingStatus.errorInfo.erroCode === 'None') {\n          //       EncodingChecker = setTimeout(checkEncodingStatus, 3000);\n          //     } else {\n          //       console.log(data);\n          //       window.alert(data.encodingStatus.errorInfo.errorMessage);\n\n          //       clearTimeout(EncodingChecker);\n          //     }\n          //   })\n          //   .catch(function (error) {\n          //     console.log(error);\n          //   });\n          // }());\n          // $aquaPlayerFrame.attr('src', '/api/v1/aqua?os=' + Util.getOSName() + '&video_name=' + data.videoName);\n        }\n      }\n    };\n\n    JqueryFormUploaderService = new JqueryFormUploaderService(options);\n  });\n\n  // 보안 플레이어에서 파일 선택 시 파일명이 세션명으로 자동 등록된다.\n  $fileUpload.change(function () {\n    var fileName = $(\"#fileupload\").get(0).files[0].name;\n    $(\"#video-title\").val(fileName.replace(/.[^.]+$/, \"\"));\n  });\n\n  $btnChangeVideo.bind(\"click\", function (e) {\n    e.preventDefault();\n\n    var videoInfo = $(\"input:first:checked\", tableVideos.rows({\n      search: \"applied\"\n    }).nodes()).data();\n\n    if (videoInfo !== undefined) {\n      if (window.confirm(\"적용하시겠습니까?\")) {\n        // 모달창 종료\n        $(\"#addVideo\").modal(\"hide\");\n        $(\"#aqua-video-code\").val(videoInfo.url);\n        $aquaPlayerFrame.attr(\"src\", \"/api/v1/aqua?os=\" + Util.getOSName() + \"&video_id=\" + videoInfo.id);\n      }\n    } else {\n      window.alert(\"비디오를 선택하세요.\");\n    }\n  });\n\n  $selectVideoProvider.on(\"change\", function () {\n    var option = $(this).val();\n\n    if (option === \"VIMEO\" || option === \"YOUTUBE\") {\n      $setVimeoPlayer.removeClass(\"blind\");\n      $setAquaPlayer.addClass(\"blind\");\n      $(\".video-preview\").addClass(\"blind\");\n    } else if (option === \"AQUA\") {\n      $setAquaPlayer.removeClass(\"blind\");\n      $setVimeoPlayer.addClass(\"blind\");\n      $(\".video-preview\").removeClass(\"blind\");\n    }\n  });\n\n  $btnUploadVideo.on(\"click\", function () {\n    // var options = {\n      // el: 'my-uploader',\n      // multiple: false\n    // };\n\n    // FineUploaderService = new FineUploaderService(options);\n\n    // var options = {\n    //   uploadFolder: $('#upload_folder').val(),\n    //   callback: function (data) {\n    //   }\n    // };\n\n    // JqueryFormUploaderService = new JqueryFormUploaderService(options);\n  });\n\n  $(\"#vimeo-video-code\").bind(\"keypress\", function (e) {\n    var key = e.which || e.keyCode;\n    if (key === 13) { displayVideo(); }\n            // initPlayer();\n  });\n\n  $btnPlayVideo.bind(\"click\", function (e) {\n    displayVideo();\n        // initPlayer();\n  });\n\n  $btnRegistVideo.bind(\"click\", function (e) {\n    e.preventDefault();\n\n    if (!validateForm()) { return false; }\n    if (!window.confirm(\"저장하시겠습니까?\")) { return false; }\n\n    var videoProvider = $(\"#video-provider\").val();\n    var videoCode;\n\n    if (videoProvider === \"VIMEO\" || videoProvider === \"YOUTUBE\") {\n      videoCode = $(\"input[name='vimeo_video_code']\").val();\n    } else if (videoProvider === \"AQUA\") {\n      videoCode = $(\"input[name='aqua_video_code']\").val();\n    }\n\n    window.axios.post(\"/course/create/video\", {\n      course_id: $(\"input[name='course_id']\").val(),\n      video_name: $(\"input[name='video_name']\").val(),\n      video_provider: videoProvider,\n      video_code: videoCode\n    })\n      .then(function (response) {\n        window.alert(\"비디오를 저장하였습니다.\");\n        window.parent.opener.winpop_listener(true);\n        window.close();\n      })\n      .catch(function (error) {\n        console.log(error);\n        return false;\n      });\n\n    // var params = $('form').serialize();\n    // $.ajax({\n    //   url: $('form').attr('action'),\n    //   type: 'POST',\n    //   data: params,\n    //   contentType: 'application/x-www-form-urlencoded; charset=UTF-8',\n    //   dataType: 'html',\n    //   success: function (response) {\n    //     window.alert('비디오를 저장하였습니다.');\n    //     // window.parent.opener.location.reload(); // 부모폼을 reload 한다.\n    //     window.parent.opener.winpop_listener(true);\n\n    //     // _confirm = false;\n    //     window.close();\n    //   }\n    // });\n  });\n\n    /**\n     * 폼 validate\n     */\n  function validateForm () {\n    var videoTitle = $(\"#video-title\");\n\n    if (!videoTitle.val()) {\n      window.alert(\"비디오 강좌명을 입력하세요.\");\n      videoTitle.focus();\n      return false;\n    }\n\n    var videoProvider = $(\"#video-provider\").val();\n    var $videoCode;\n\n    if (videoProvider === \"VIMEO\" || videoProvider === \"YOUTUBE\") {\n      $videoCode = $(\"#vimeo-video-code\");\n    } else if (videoProvider === \"AQUA\") {\n      $videoCode = $(\"#aqua-video-code\");\n    }\n\n    if (!$videoCode.val()) {\n      window.alert(\"비디오 코드를 입력하세요.\");\n      $videoCode.focus();\n      return false;\n    }\n\n    return true;\n  }\n\n    /**\n     * 비디오를 표시한다.\n     */\n  function displayVideo () {\n    var videoCode = $(\"#vimeo-video-code\").val();\n    var videoProvider = $(\"#video-provider\").val();\n    var videoPlayer = $(\"#video-player\");\n\n    if (!videoCode) { return false; }\n\n    switch (videoProvider) {\n    case \"YOUTUBE\":\n      videoPlayer.html(\"<iframe width=\\\"100%\\\" height=\\\"600\\\" src=\\\"/api/v1/youtube?id=\" + videoCode + \"\\\"\" +\n                    \"frameborder=\\\"0\\\" allowfullscreen></iframe>\");\n      break;\n    case \"VIMEO\":\n      videoPlayer.html(\"<iframe src=\\\"https://player.vimeo.com/video/\" + videoCode + \"\\\"?title=0&byline=0&portrait=0\\\" \" +\n                    \"width=\\\"100%\\\" height=\\\"600\\\" frameborder=\\\"0\\\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>\");\n      break;\n\n    default:\n      break;\n    }\n  }\n\n    /**\n     * 윈도우 팝업창 종료 시 발생\n     *\n     */\n  window.onbeforeunload = function (event) {\n    // if (_confirm) { return confirm('진행중인 작업이 모두 사라집니다. 계속하시겠습니까?'); }\n  };\n});\n"],"sourceRoot":"/source/"}