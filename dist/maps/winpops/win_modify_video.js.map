{"version":3,"sources":["winpops/win_modify_video.js"],"names":["requirejs","$btnUploadVideo","JqueryFormUploaderService","option","$setVimeoPlayer","val","addClass","$setAquaPlayer","removeClass","$","validateForm","videoTitle","focus","window","alert","videoProvider","$videoCode","videoCode","console","$videoPlayer","html","$aquaPlayerFrame","data","attr","Util","getOSName","$btnPlayVideo","$selectVideoProvider","tableVideos","initDataTable","$btnChangeVideo","buttons","$fileUpload","uploadFolder","options","callback","success","displayVideo","setVideoOptions","change","fileName","get","files","name","replace","videoInfo","e","search","rows","nodes","undefined","confirm","modal","url","id","on","which","keyCode","bind","$btnModifyVideo","preventDefault","axios","post","course_id","course_list_id","this","video_name","video_provider","video_code","video_id","response","parent","opener","close","winpop_listener","catch","error","log","onbeforeunload","event","_confirm"],"mappings":"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","file":"winpops/win_modify_video.js","sourcesContent":["\"use strict\";\n\nrequirejs([\n  \"common\",\n  \"Vimeo\",\n  // 'jqueryUploaderService'\n  \"jqueryFormUploaderService\"\n], function (Util, Vimeo, JqueryFormUploaderService) {\n  var $ = $ || window.$;\n  var $btnModifyVideo = $(\"#modify-video\");\n  var $btnUploadVideo = $(\"#uploadVideo\");\n  var $btnPlayVideo = $(\"#play-video\");\n  var $selectVideoProvider = $(\"#video-provider\");\n  var $setAquaPlayer = $(\".aquaplayer-settings\");\n  var $setVimeoPlayer = $(\".vimeo-settings\");\n  var $aquaPlayerFrame = $(\"#aquaplayer_frame\");\n  // datatable 설정\n  var tableVideos = Util.initDataTable($(\"#table_add_video\"), { buttons: [] });\n  var $btnChangeVideo = $(\"#btnApplyVideo\");\n  var $fileUpload = $(\"#fileupload\");\n\n  $(function () {\n    // 보안플레이어 영상 업로더 초기화\n    var options = {\n      uploadFolder: $(\"#upload_folder\").val(),\n      callback: function (data) {\n        if (data.success) {\n          // displayVideo();\n        }\n      }\n    };\n\n    JqueryFormUploaderService = new JqueryFormUploaderService(options);\n\n    setVideoOptions();\n    displayVideo();\n  });\n\n  // 보안 플레이어에서 파일 선택 시 파일명이 세션명으로 자동 등록된다.\n  $fileUpload.change(function () {\n    var fileName = $(\"#fileupload\").get(0).files[0].name;\n    $(\"#video-title\").val(fileName.replace(/.[^.]+$/, \"\"));\n  });\n\n  $btnChangeVideo.bind(\"click\", function (e) {\n    e.preventDefault();\n\n    var videoInfo = $(\"input:first:checked\", tableVideos.rows({\n      search: \"applied\"\n    }).nodes()).data();\n\n    if (videoInfo !== undefined) {\n      if (window.confirm(\"적용하시겠습니까?\")) {\n        // 모달창 종료\n        $(\"#addVideo\").modal(\"hide\");\n        $(\"#aqua-video-code\").val(videoInfo.url);\n        $aquaPlayerFrame.attr(\"src\", \"/api/v1/aqua?os=\" + Util.getOSName() + \"&video_id=\" + videoInfo.id);\n      }\n    } else {\n      window.alert(\"비디오를 선택하세요.\");\n    }\n  });\n\n  $selectVideoProvider.on(\"change\", function () {\n    setVideoOptions();\n  });\n\n  function setVideoOptions () {\n    var option = $selectVideoProvider.val();\n\n    if (option === \"VIMEO\" || option === \"YOUTUBE\") {\n      $setVimeoPlayer.removeClass(\"blind\");\n      $setAquaPlayer.addClass(\"blind\");\n      $(\".video-preview\").addClass(\"blind\");\n    } else if (option === \"AQUA\") {\n      $setAquaPlayer.removeClass(\"blind\");\n      $setVimeoPlayer.addClass(\"blind\");\n      $(\".video-preview\").removeClass(\"blind\");\n    }\n  }\n\n  $btnUploadVideo.on(\"click\", function () {\n  });\n\n  $(\"#video-code\").bind(\"keypress\", function (e) {\n    var key = e.which || e.keyCode;\n    if (key === 13) {\n      displayVideo();\n    }\n  });\n\n  $btnPlayVideo.bind(\"click\", function (e) {\n    displayVideo();\n  });\n\n  $btnModifyVideo.bind(\"click\", function (e) {\n    e.preventDefault();\n\n    if (!validateForm()) { return false; }\n    if (!window.confirm(\"저장하시겠습니까?\")) { return false; }\n\n    var videoProvider = $(\"#video-provider\").val();\n    var videoCode;\n\n    if (videoProvider === \"VIMEO\" || videoProvider === \"YOUTUBE\") {\n      videoCode = $(\"input[name='vimeo_video_code']\").val();\n    } else if (videoProvider === \"AQUA\") {\n      videoCode = $(\"input[name='aqua_video_code']\").val();\n    }\n\n    window.axios.post(\"/course/modify/video\", {\n      course_id: $(\"input[name='course_id']\").val(),\n      course_list_id: $(this).data(\"course-list-id\"),\n      video_name: $(\"input[name='video_name']\").val(),\n      video_provider: videoProvider,\n      video_code: videoCode,\n      video_id: $(this).data(\"video-id\")\n    })\n      .then(function (response) {\n        window.alert(\"비디오를 저장하였습니다.\");\n        window.parent.opener.winpop_listener(true);\n        window.close();\n      })\n      .catch(function (error) {\n        console.log(error);\n        return false;\n      });\n\n    // legacy\n\n    // var params = $('form').serializeArray();\n    // params.push({\n    //   name: 'course_list_id',\n    //   value: $(this).data('course-list-id')\n    // });\n    // params.push({\n    //   name: 'video_id',\n    //   value: $(this).data('video-id')\n    // });\n\n    // // console.log(params);\n    // // return false;\n\n    // $.ajax({\n    //   url: $('form').attr('action'),\n    //   type: 'PUT',\n    //   data: params,\n    //   contentType: 'application/x-www-form-urlencoded; charset=UTF-8',\n    //   dataType: 'html',\n    //   success: function (response) {\n    //     alert('비디오를 저장하였습니다.');\n    //     // window.parent.opener.location.reload(); // 부모폼을 reload 한다.\n    //     window.parent.opener.winpop_listener(true);\n    //     _confirm = false;\n    //     window.close();\n    //   }\n    // });\n  });\n\n  /**\n   * 폼 validate\n   */\n    /**\n     * 폼 validate\n     */\n  function validateForm () {\n    var videoTitle = $(\"#video-title\");\n\n    if (!videoTitle.val()) {\n      window.alert(\"비디오 강좌명을 입력하세요.\");\n      videoTitle.focus();\n      return false;\n    }\n\n    var videoProvider = $(\"#video-provider\").val();\n    var $videoCode;\n\n    if (videoProvider === \"VIMEO\" || videoProvider === \"YOUTUBE\") {\n      $videoCode = $(\"#vimeo-video-code\");\n    } else if (videoProvider === \"AQUA\") {\n      $videoCode = $(\"#aqua-video-code\");\n    }\n\n    if (!$videoCode.val()) {\n      window.alert(\"비디오 코드를 입력하세요.\");\n      $videoCode.focus();\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * 비디오를 표시한다.\n   */\n  function displayVideo () {\n    var videoProvider = $(\"#video-provider\").val();\n    var videoCode;\n    var $videoPlayer;\n\n    console.log(videoProvider);\n\n    switch (videoProvider) {\n    case \"YOUTUBE\":\n      videoCode = $(\"#vimeo-video-code\").val();\n      $videoPlayer = $(\"#video-player\");\n\n      if (!videoCode) return false;\n\n      $videoPlayer.html(\"<iframe width=\\\"100%\\\" height=\\\"600\\\" src=\\\"/api/v1/youtube?id=\" + videoCode + \"\\\"\" +\n                    \"frameborder=\\\"0\\\" allowfullscreen></iframe>\");\n      break;\n\n    case \"VIMEO\":\n      videoCode = $(\"#vimeo-video-code\").val();\n      $videoPlayer = $(\"#video-player\");\n\n      if (!videoCode) return false;\n\n      $videoPlayer.html(\"<iframe src=\\\"https://player.vimeo.com/video/\" + videoCode + \"\\\"?title=0&byline=0&portrait=0\\\" \" +\n          \"width=\\\"100%\\\" height=\\\"600\\\" frameborder=\\\"0\\\" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>\");\n      break;\n\n    case \"AQUA\":\n      videoCode = $(\"#modify-video\").data(\"video-id\");\n      $aquaPlayerFrame.attr(\"src\", \"/api/v1/aqua?os=\" + Util.getOSName() + \"&video_id=\" + videoCode);\n      break;\n\n    default:\n      break;\n    }\n  }\n\n  /**\n   * 윈도우 팝업창 종료 시 발생\n   *\n   */\n  window.onbeforeunload = function (event) {\n    if (_confirm) {\n      return confirm(\"진행중인 작업이 모두 사라집니다. 계속하시겠습니까?\");\n    }\n  };\n});\n"],"sourceRoot":"/source/"}